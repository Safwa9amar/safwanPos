// /prisma/schema/purchase.prisma

// For formal orders from a specific supplier
model PurchaseOrder {
  id                    String      @id @default(cuid())
  orderDate             DateTime    @default(now())
  expectedDeliveryDate  DateTime?
  status                POStatus    @default(PENDING)
  totalCost             Float

  userId                String
  user                  User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  supplierId            String
  supplier              Supplier    @relation(fields: [supplierId], references: [id], onDelete: Restrict)

  items                 PurchaseOrderItem[]

  @@index([userId])
  @@index([supplierId])
}

model PurchaseOrderItem {
  id                  String    @id @default(cuid())
  quantity            Float
  costPrice           Float
  receivedQuantity    Float     @default(0)
  
  purchaseOrderId     String
  purchaseOrder       PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  productId           String
  product             Product   @relation(fields: [productId], references: [id], onDelete: Restrict)

  priceHistoryEntry   PurchasePriceHistory?

  @@index([purchaseOrderId])
  @@index([productId])
}

// For informal, direct purchases from stores
model DirectPurchase {
  id            String    @id @default(cuid())
  purchaseDate  DateTime  @default(now())
  storeName     String?
  notes         String?
  totalCost     Float

  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  items         DirectPurchaseItem[]

  @@index([userId])
}

model DirectPurchaseItem {
  id              String    @id @default(cuid())
  quantity        Float
  costPrice       Float

  purchaseId      String
  purchase        DirectPurchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)

  productId       String
  product         Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  priceHistoryEntry PurchasePriceHistory?

  @@index([purchaseId])
  @@index([productId])
}
