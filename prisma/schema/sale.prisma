import { User } from "./user.prisma"
import { Product } from "./product.prisma"
import { Customer } from "./customer.prisma"
import { PaymentType } from "./enums.prisma"

/// Represents a completed sale transaction.
model Sale {
  id          String      @id @default(cuid())
  saleDate    DateTime    @default(now())
  totalAmount Float
  paymentType PaymentType
  items       SaleItem[]
  
  discount    Float       @default(0)
  amountPaid  Float

  customer   Customer? @relation(fields: [customerId], references: [id])
  customerId String?

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([customerId])
}

/// Represents an individual item within a sale.
model SaleItem {
  id        String  @id @default(cuid())
  sale      Sale    @relation(fields: [saleId], references: [id], onDelete: Cascade)
  saleId    String
  product   Product @relation(fields: [productId], references: [id], onDelete: Restrict)
  productId String
  quantity  Float
  price     Float // Price at the time of sale
  discount  Float   @default(0)

  @@index([saleId])
  @@index([productId])
}
