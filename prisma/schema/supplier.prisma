import { User } from "./user.prisma"
import { PurchaseOrder } from "./purchase.prisma"
import { SupplierStatus } from "./enums.prisma"

/// Represents a supplier of products.
model Supplier {
  id                   String    @id @default(cuid())
  name                 String
  contactName          String?
  email                String?   @unique
  phone                String?
  address              String?
  balance              Float     @default(0) // Positive means we owe the supplier money
  
  logoUrl              String?
  taxId                String?
  category             String?
  paymentTerms         String?
  deliverySchedule     String?
  communicationChannel String?
  status               SupplierStatus @default(ACTIVE)
  notes                String?   @db.Text
  
  contractStartDate    DateTime?
  contractEndDate      DateTime?
  monthlySupplyQuota   Float?
  qualityRating        Int?

  purchaseOrders PurchaseOrder[]
  payments       SupplierPayment[]
  credits        SupplierCredit[]

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

/// Represents a payment made to a supplier.
model SupplierPayment {
  id          String   @id @default(cuid())
  supplierId  String
  supplier    Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  amount      Float
  paymentDate DateTime @default(now())
  notes       String?

  userId String
  user   User   @relation(fields: [userId], references: [id]) // No cascade, keep payment history

  @@index([supplierId])
  @@index([userId])
}


/// Represents a credit or debit adjustment for a supplier.
model SupplierCredit {
  id             String   @id @default(cuid())
  supplierId     String
  supplier       Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  amount         Float // Can be positive (we owe more) or negative (they owe us)
  reason         String
  adjustmentDate DateTime @default(now())
  
  userId String
  user   User   @relation(fields: [userId], references: [id]) // No cascade

  @@index([supplierId])
  @@index([userId])
}
