// /prisma/schema/user.prisma

model User {
  id                      String      @id @default(cuid())
  name                    String?
  email                   String      @unique
  password                String
  emailVerified           DateTime?
  emailVerificationToken  String?     @unique
  passwordResetToken      String?     @unique
  passwordResetTokenExpires DateTime?
  role                    UserRole    @default(CASHIER)
  createdAt               DateTime    @default(now())
  updatedAt               DateTime    @updatedAt
  
  // Tenancy: The admin who created this user. Null for the root admin.
  createdById             String?
  createdBy               User?       @relation("AdminCreatedUsers", fields: [createdById], references: [id], onDelete: SetNull)
  createdUsers            User[]      @relation("AdminCreatedUsers")

  // Subscription Details
  subscriptionStatus      SubscriptionStatus @default(TRIAL)
  trialEndsAt             DateTime?

  // Relationships
  companyProfile          CompanyProfile?
  sales                   Sale[]
  capitalEntries          CapitalEntry[]
  expenses                Expense[]
  expenseCategories       ExpenseCategory[]
  products                Product[]
  barcodes                Barcode[]
  categories              Category[]
  customers               Customer[]
  payments                Payment[]
  suppliers               Supplier[]
  purchaseOrders          PurchaseOrder[]
  supplierPayments        SupplierPayment[]
  supplierCredits         SupplierCredit[]
  directPurchases         DirectPurchase[]
  purchasePriceHistory    PurchasePriceHistory[]
  repairJobs              RepairJob[]
  reports                 Report[]
}

model CompanyProfile {
  id            String    @id @default(cuid())
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  name          String?
  logoUrl       String?
  address       String?
  phone         String?
  email         String?
  website       String?

  taxId1Label   String?
  taxId1Value   String?
  taxId2Label   String?
  taxId2Value   String?

  invoiceTitle  String?
  invoiceFooter String?

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}
